import React, { Component, ReactNode } from 'react';\nimport { AlertTriangle, RefreshCw, Home, Bug } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: any;\n  retryCount: number;\n}\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: ReactNode;\n  onError?: (error: Error, errorInfo: any) => void;\n  maxRetries?: number;\n}\n\nexport class HelpdeskErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      retryCount: 0\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    return {\n      hasError: true,\n      error\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: any) {\n    this.setState({\n      error,\n      errorInfo\n    });\n\n    // Log error to monitoring service\n    console.error('Helpdesk Error Boundary caught an error:', error, errorInfo);\n    \n    // Call optional error handler\n    this.props.onError?.(error, errorInfo);\n\n    // Report to error tracking service (e.g., Sentry)\n    if (process.env.NODE_ENV === 'production') {\n      // Report error to your tracking service\n      // Example: Sentry.captureException(error, { contexts: { errorBoundary: errorInfo } });\n    }\n  }\n\n  handleRetry = () => {\n    const { maxRetries = 3 } = this.props;\n    const { retryCount } = this.state;\n    \n    if (retryCount < maxRetries) {\n      this.setState({\n        hasError: false,\n        error: null,\n        errorInfo: null,\n        retryCount: retryCount + 1\n      });\n    }\n  };\n\n  handleReset = () => {\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      retryCount: 0\n    });\n  };\n\n  render() {\n    const { hasError, error, retryCount } = this.state;\n    const { children, fallback, maxRetries = 3 } = this.props;\n\n    if (hasError) {\n      // Custom fallback UI\n      if (fallback) {\n        return fallback;\n      }\n\n      // Determine error type for better user experience\n      const isNetworkError = error?.message.includes('fetch') || error?.message.includes('network');\n      const isChunkLoadError = error?.message.includes('ChunkLoadError') || error?.message.includes('Loading chunk');\n      const canRetry = retryCount < maxRetries;\n\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4\">\n          <Card className=\"max-w-2xl w-full\">\n            <CardHeader className=\"text-center pb-4\">\n              <div className=\"mx-auto mb-4 w-16 h-16 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center\">\n                <AlertTriangle className=\"w-8 h-8 text-red-600 dark:text-red-400\" />\n              </div>\n              <CardTitle className=\"text-2xl text-gray-900 dark:text-gray-100\">\n                {isChunkLoadError ? 'App Update Available' : isNetworkError ? 'Connection Error' : 'Something went wrong'}\n              </CardTitle>\n            </CardHeader>\n            \n            <CardContent className=\"space-y-6\">\n              {/* Error-specific messages */}\n              {isChunkLoadError ? (\n                <Alert>\n                  <AlertDescription>\n                    The app has been updated. Please refresh the page to load the latest version.\n                  </AlertDescription>\n                </Alert>\n              ) : isNetworkError ? (\n                <Alert>\n                  <AlertDescription>\n                    Unable to connect to the server. Please check your internet connection and try again.\n                  </AlertDescription>\n                </Alert>\n              ) : (\n                <Alert>\n                  <AlertDescription>\n                    An unexpected error occurred in the helpdesk module. Our team has been notified.\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              {/* Error details in development */}\n              {process.env.NODE_ENV === 'development' && (\n                <Card className=\"bg-gray-50 dark:bg-gray-800\">\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm flex items-center gap-2\">\n                      <Bug className=\"w-4 h-4\" />\n                      Error Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <pre className=\"text-xs text-gray-600 dark:text-gray-400 whitespace-pre-wrap overflow-auto max-h-48\">\n                      {error?.toString()}\n                      {this.state.errorInfo?.componentStack}\n                    </pre>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Retry count indicator */}\n              {retryCount > 0 && (\n                <div className=\"text-sm text-gray-500 dark:text-gray-400 text-center\">\n                  Retry attempt {retryCount} of {maxRetries}\n                </div>\n              )}\n\n              {/* Action buttons */}\n              <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n                {isChunkLoadError ? (\n                  <Button \n                    onClick={() => window.location.reload()}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <RefreshCw className=\"w-4 h-4\" />\n                    Refresh Page\n                  </Button>\n                ) : canRetry ? (\n                  <Button \n                    onClick={this.handleRetry}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <RefreshCw className=\"w-4 h-4\" />\n                    Try Again\n                  </Button>\n                ) : (\n                  <Button \n                    onClick={this.handleReset}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <RefreshCw className=\"w-4 h-4\" />\n                    Reset\n                  </Button>\n                )}\n                \n                <Button \n                  variant=\"outline\" \n                  onClick={() => window.location.href = '/'}\n                  className=\"flex items-center gap-2\"\n                >\n                  <Home className=\"w-4 h-4\" />\n                  Go to Dashboard\n                </Button>\n              </div>\n\n              {/* Contact support */}\n              <div className=\"text-center text-sm text-gray-500 dark:text-gray-400\">\n                Need help? Contact{' '}\n                <a \n                  href=\"mailto:support@company.com\" \n                  className=\"text-blue-600 dark:text-blue-400 hover:underline\"\n                >\n                  IT Support\n                </a>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    return children;\n  }\n}\n\n// Higher-order component wrapper\nexport function withErrorBoundary<P extends object>(\n  Component: React.ComponentType<P>,\n  errorBoundaryProps?: Omit<ErrorBoundaryProps, 'children'>\n) {\n  return function WrappedComponent(props: P) {\n    return (\n      <HelpdeskErrorBoundary {...errorBoundaryProps}>\n        <Component {...props} />\n      </HelpdeskErrorBoundary>\n    );\n  };\n}\n\n// Hook for error handling in functional components\nexport function useErrorHandler() {\n  return React.useCallback((error: Error, errorInfo?: any) => {\n    console.error('Error caught by error handler:', error, errorInfo);\n    \n    // Could integrate with error reporting service\n    if (process.env.NODE_ENV === 'production') {\n      // Report to error tracking service\n    }\n  }, []);\n}\n\n// Component-level error boundary for smaller sections\nexport const ComponentErrorBoundary: React.FC<{\n  children: ReactNode;\n  componentName?: string;\n  className?: string;\n}> = ({ children, componentName = 'Component', className = '' }) => {\n  return (\n    <HelpdeskErrorBoundary\n      fallback={\n        <div className={`p-4 border border-red-200 dark:border-red-800 rounded-lg bg-red-50 dark:bg-red-900/20 ${className}`}>\n          <div className=\"flex items-center gap-2 text-red-700 dark:text-red-300\">\n            <AlertTriangle className=\"w-4 h-4\" />\n            <span className=\"text-sm font-medium\">\n              {componentName} Error\n            </span>\n          </div>\n          <p className=\"text-sm text-red-600 dark:text-red-400 mt-1\">\n            This component encountered an error and couldn't be displayed.\n          </p>\n        </div>\n      }\n    >\n      {children}\n    </HelpdeskErrorBoundary>\n  );\n};"